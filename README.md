some stuff extracted from shell's source code <3
